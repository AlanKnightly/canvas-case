"use strict";window.addEventListener("load",function(e){var c=null,r=null,o=document.getElementById("img-width"),l=document.getElementById("img-height"),i=document.getElementById("output"),a="oninput"in o?"input":"propertychange",d={},t=document.getElementById("canvas");t.getContext?c=t.getContext("2d"):alert("当前浏览器不支持canvas绘制功能哦");function n(){var e=d["img-x"],t=d["img-y"],n=d["img-width"],i=d["img-height"],a=d["img-rotate"];c.save(),c.translate(e,t),c.rotate(a*Math.PI/180),c.drawImage(r,0,0,r.width,r.height,0,0,n,i),c.restore()}function g(e){var t=0<arguments.length&&void 0!==e&&e,n=d["clip-width"],i=d["clip-height"],a=d["clip-rotate"],r=d["clip-x"],o=d["clip-y"];c.save(),c.translate(r,o),c.rotate(a*Math.PI/180),c[t?"fillRect":"strokeRect"](0,0,n,i),c.restore()}function s(){c&&(c.save(),c.clearRect(0,0,300,300),n(),g(),c.restore())}document.getElementById("confirm").addEventListener("click",function(){c.save(),c.clearRect(0,0,300,300),n(),c.globalCompositeOperation="destination-in",g(!0),function(e){var t=new Image;t.crossOrigin="anonymous",t.src=e;var n=document.querySelectorAll("#output img");i.insertBefore(t,n[0]),5<n.length&&i.removeChild(n[5])}(t.toDataURL()),c.restore()}),document.getElementById("reset").addEventListener("click",s),document.getElementById("imgSelector").addEventListener("change",function(e){var t,n,i,a=e.target.files;d["clip-rotate"]=0,a[d["img-rotate"]=0]&&((t=new Image).crossOrigin="anonymous",(n=new FileReader).onload=(i=t,function(e){i.addEventListener("load",function(){d["img-width"]=o.value=i.width,d["img-height"]=l.value=i.height,r=i,s()}),i.src=e.target.result}),n.readAsDataURL(a[0]))});function u(e,n){function t(e){var t=e.target.value;n[e.target.id]=isNaN(t)?0:t,s()}Array.prototype.slice.call(e).forEach(function(e){n[e.id]=Number(e.value),e.addEventListener(a,t)})}(r=new Image).crossOrigin="anonymous",r.addEventListener("load",function(){o.value=r.width,l.value=r.height;var e=document.querySelectorAll(".img-params input,.clip-params input");u(e,d),s()}),r.src="/static/img/lisa.jpeg"});